version: 1
applications:
  - frontend:
      phases:
        preBuild:
          commands:
            - curl -fsSL https://bun.sh/install | bash
            - export PATH="$HOME/.bun/bin:$PATH"
            - cd ../.. && bun install
            - bun run db:generate
            - cd ../.. && npx turbo build --filter=@trycompai/ui --filter=@trycompai/db --filter=@trycompai/email --filter=@trycompai/kv --filter=@trycompai/analytics --filter=@comp/integration-platform
        build:
          commands:
            - export PATH="$HOME/.bun/bin:$PATH"
            - npx next build
      artifacts:
        baseDirectory: .next
        files:
          - '**/*'
      cache:
        paths:
          - ../../node_modules/**/*
    appRoot: apps/app
